<div class="card h-100 product-card shadow-sm">
    <div class="position-relative">
        <a href="{{ product.get_absolute_url }}">
            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}"
                 style="height: 200px; object-fit: cover;">
        </a>
        {% if product.discount_percent > 0 %}
        <span class="badge bg-danger position-absolute top-0 end-0 m-2">
            -{{ product.discount_percent }}%
        </span>
        {% endif %}
        {% if product.video_url %}
        <span class="badge bg-primary position-absolute top-0 start-0 m-2">
            <i class="bi bi-play-circle"></i> Video
        </span>
        {% endif %}
    </div>
    <div class="card-body d-flex flex-column">
        <h6 class="card-title">
            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                {{ product.name|truncatechars:40 }}
            </a>
        </h6>
        <p class="text-muted small mb-2">{{ product.category.name }}</p>
        
        <!-- Rating -->
        <div class="mb-2">
            {% for i in "12345" %}
                {% if forloop.counter <= product.average_rating %}
                <i class="bi bi-star-fill text-warning small"></i>
                {% else %}
                <i class="bi bi-star text-warning small"></i>
                {% endif %}
            {% endfor %}
            <small class="text-muted">({{ product.reviews.count }})</small>
        </div>
        
        <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center mb-2">
                {% if product.sale_price %}
                <div>
                    <span class="text-decoration-line-through text-muted small">{{ product.price|floatformat:0 }}đ</span>
                    <span class="text-danger fw-bold">{{ product.sale_price|floatformat:0 }}đ</span>
                </div>
                {% else %}
                <span class="text-primary fw-bold">{{ product.price|floatformat:0 }}đ</span>
                {% endif %}
                <small class="text-muted">Đã bán {{ product.sold_count }}</small>
            </div>
            
            <div class="d-grid gap-2">
                <form action="{% url 'cart_add' product.id %}" method="POST" class="add-to-cart-form">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-outline-primary btn-sm w-100">
                        <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
